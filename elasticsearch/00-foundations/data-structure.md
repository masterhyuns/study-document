# ğŸ“Š Elasticsearch ë°ì´í„° êµ¬ì¡° ì‹¬ì¸µ ë¶„ì„

## ğŸ¯ ë°ì´í„° êµ¬ì¡° ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Elasticsearch Cluster             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          Index                    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  Shard 0  â”‚  â”‚  Shard 1  â”‚      â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚   â”‚
â”‚  â”‚  â”‚ Segments  â”‚  â”‚ Segments  â”‚      â”‚   â”‚
â”‚  â”‚  â”‚ Documents â”‚  â”‚ Documents â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—œï¸ ì—­ì¸ë±ìŠ¤ (Inverted Index) êµ¬ì¡°

### ê¸°ë³¸ ê°œë…

```
ë¬¸ì„œ ë°ì´í„°:
Doc1: "Elasticsearch is a search engine"
Doc2: "Search engines are powerful tools"
Doc3: "Elasticsearch provides full-text search"

â†“ í† í°í™” ë° ì •ê·œí™”

ì—­ì¸ë±ìŠ¤ êµ¬ì¡°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Term      â”‚      Posting List          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ elasticsearch â”‚ Doc1(pos:0), Doc3(pos:0)  â”‚
â”‚ search        â”‚ Doc1(pos:3), Doc2(pos:0), â”‚
â”‚               â”‚ Doc3(pos:3)               â”‚
â”‚ engine        â”‚ Doc1(pos:4), Doc2(pos:1)  â”‚
â”‚ powerful      â”‚ Doc2(pos:3)                â”‚
â”‚ tools         â”‚ Doc2(pos:4)                â”‚
â”‚ provides      â”‚ Doc3(pos:1)                â”‚
â”‚ full-text     â”‚ Doc3(pos:2)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì—­ì¸ë±ìŠ¤ ì„¸ë¶€ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Inverted Index Components         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚  1. Term Dictionary (í… ì‚¬ì „)               â”‚
â”‚     â€¢ ëª¨ë“  ê³ ìœ  í…Œë¦„ì˜ ì •ë ¬ëœ ëª©ë¡            â”‚
â”‚     â€¢ FST (Finite State Transducer) ì‚¬ìš©  â”‚
â”‚                                            â”‚
â”‚  2. Posting List (í¬ìŠ¤íŒ… ë¦¬ìŠ¤íŠ¸)            â”‚
â”‚     â€¢ ê° í…Œë¦„ì´ ë‚˜íƒ€ë‚˜ëŠ” ë¬¸ì„œ ID ëª©ë¡        â”‚
â”‚     â€¢ ìœ„ì¹˜ ì •ë³´ (position)                  â”‚
â”‚     â€¢ ë¹ˆë„ ì •ë³´ (frequency)                 â”‚
â”‚                                            â”‚
â”‚  3. Doc Values                             â”‚
â”‚     â€¢ ì»´ëŸ¼ ì§€í–¥ ì €ì¥                         â”‚
â”‚     â€¢ ì •ë ¬, ì§‘ê³„ìš©                           â”‚
â”‚                                            â”‚
â”‚  4. Stored Fields                          â”‚
â”‚     â€¢ ì›ë³¸ ë¬¸ì„œ ë°ì´í„°                        â”‚
â”‚     â€¢ _source í•„ë“œ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ ì„¸ê·¸ë¨¼íŠ¸ (Segment) êµ¬ì¡°

### ì„¸ê·¸ë¨¼íŠ¸ ë‚´ë¶€ êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Segment Structure             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Segment Info (.si)                  â”‚  â”‚
â”‚  â”‚ â€¢ ì„¸ê·¸ë¨¼íŠ¸ ë©”íƒ€ë°ì´í„°                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Field Info (.fnm)                   â”‚  â”‚
â”‚  â”‚ â€¢ í•„ë“œ ëª…ê³¼ ì„¤ì •                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Term Dictionary (.tim)              â”‚  â”‚
â”‚  â”‚ â€¢ í…Œë¦„ ì‚¬ì „ (FST)                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Term Index (.tip)                   â”‚  â”‚
â”‚  â”‚ â€¢ í…Œë¦„ ì‚¬ì „ì˜ ì¸ë±ìŠ¤                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Postings (.doc, .pos, .pay)        â”‚  â”‚
â”‚  â”‚ â€¢ ë¬¸ì„œ ID, ìœ„ì¹˜, í˜ì´ë¡œë“œ              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Stored Fields (.fdt, .fdx)         â”‚  â”‚
â”‚  â”‚ â€¢ ì›ë³¸ í•„ë“œ ë°ì´í„°                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Doc Values (.dvd, .dvm)            â”‚  â”‚
â”‚  â”‚ â€¢ ì»´ëŸ¼ ì§€í–¥ ì €ì¥                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Term Vectors (.tvd, .tvx)          â”‚  â”‚
â”‚  â”‚ â€¢ í…Œë¦„ ë²¡í„° ì •ë³´                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„¸ê·¸ë¨¼íŠ¸ ë³‘í•© ê³¼ì •

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          Segment Merging Process          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. ì´ˆê¸° ìƒíƒœ:
   [S1:10MB] [S2:10MB] [S3:10MB] [S4:5MB]

2. ë³‘í•© íŠ¸ë¦¬ê±° (3ê°œì˜ 10MB ì„¸ê·¸ë¨¼íŠ¸):
   Merging: [S1 + S2 + S3] â†’ [S5:30MB]
   
3. ë³‘í•© í›„:
   [S5:30MB] [S4:5MB]

4. ìƒˆ ë°ì´í„° ì¶”ê°€:
   [S5:30MB] [S4:5MB] [S6:10MB] [S7:10MB]

5. ë‹¤ì‹œ ë³‘í•©:
   [S5:30MB] [S8:25MB]
```

## ğŸ’¾ Doc Values êµ¬ì¡°

### Row vs Column ì§€í–¥ ì €ì¥

```
Row-Oriented (Stored Fields):
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DocIDâ”‚  Name  â”‚  Age  â”‚  City  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1   â”‚ Alice  â”‚  30   â”‚ Seoul  â”‚ â† Doc1
â”‚  2   â”‚  Bob   â”‚  25   â”‚ Busan  â”‚ â† Doc2
â”‚  3   â”‚ Carol  â”‚  28   â”‚ Seoul  â”‚ â† Doc3
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Column-Oriented (Doc Values):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Name Column: [Alice, Bob, Carol]         â”‚
â”‚ Age Column:  [30, 25, 28]                â”‚
â”‚ City Column: [Seoul, Busan, Seoul]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Doc Values íƒ€ì…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Doc Values Types               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ 1. NUMERIC                               â”‚
â”‚    â€¢ integers, floats, dates            â”‚
â”‚    â€¢ ì••ì¶•ëœ ìˆ«ì ë°°ì—´                      â”‚
â”‚                                          â”‚
â”‚ 2. BINARY                                â”‚
â”‚    â€¢ byte arrays                        â”‚
â”‚    â€¢ ê³ ì • í¬ê¸° ë˜ëŠ” ê°€ë³€ í¬ê¸°              â”‚
â”‚                                          â”‚
â”‚ 3. SORTED                                â”‚
â”‚    â€¢ keyword í•„ë“œ                        â”‚
â”‚    â€¢ ì •ë ¬ëœ ë¬¸ìì—´                         â”‚
â”‚                                          â”‚
â”‚ 4. SORTED_SET                            â”‚
â”‚    â€¢ multi-valued í•„ë“œ                  â”‚
â”‚    â€¢ íƒœê·¸, ì¹´í…Œê³ ë¦¬ ë“±                      â”‚
â”‚                                          â”‚
â”‚ 5. SORTED_NUMERIC                        â”‚
â”‚    â€¢ multi-valued numeric í•„ë“œ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Translog êµ¬ì¡°

### Translog ë™ì‘ ë°©ì‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Translog Write Process           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
    1. Document Write Request
                 â†“
    2. Write to Memory Buffer
                 â†“
    3. Append to Translog (fsync)
                 â†“
    4. Return Success to Client
                 â†“
    5. Refresh (1s) - Searchable
                 â†“
    6. Flush - Commit to Segment
                 â†“
    7. Clear Translog
```

### Translog íŒŒì¼ êµ¬ì¡°

```
Translog Directory:
/data/nodes/0/indices/{index-uuid}/0/translog/
â”œâ”€â”€ translog-1.tlog      (oldest)
â”œâ”€â”€ translog-2.tlog
â”œâ”€â”€ translog-3.tlog      (current)
â”œâ”€â”€ translog.ckp         (checkpoint)
â””â”€â”€ translog-3.tlog.tmp  (temp file)

Translog Entry Structure:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Length  â”‚ Type â”‚ Seq# â”‚ Primary Term â”‚ Data â”‚
â”‚ (4 byte)â”‚(1 b) â”‚(8 b) â”‚   (8 byte)   â”‚(var) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Field Data vs Doc Values

### ë¹„êµ í‘œ

| íŠ¹ì„± | Field Data | Doc Values |
|------|------------|------------|
| **ì €ì¥ ìœ„ì¹˜** | JVM Heap Memory | Disk (OS Cache) |
| **ë¡œë”© ì‹œì ** | Query Time (Lazy) | Index Time |
| **ë©”ëª¨ë¦¬ ì‚¬ìš©** | ë§¤ìš° ë†’ìŒ | ë‚®ìŒ (OS Cache) |
| **ì„±ëŠ¥** | ë¹ ë¦„ (ë©”ëª¨ë¦¬) | ì ë‹¹ (Disk/Cache) |
| **GC ì˜í–¥** | í¬ê²Œ ë°›ìŒ | ë°›ì§€ ì•ŠìŒ |
| **í•„ë“œ íƒ€ì…** | text í•„ë“œ | ëª¨ë“  í•„ë“œ (text ì œì™¸) |

### ì‚¬ìš© ì˜ˆì‹œ

```json
// Field Data ì‚¬ìš© (ê¶Œì¥í•˜ì§€ ì•ŠìŒ)
{
  "mappings": {
    "properties": {
      "content": {
        "type": "text",
        "fielddata": true  // ìœ„í—˜!
      }
    }
  }
}

// Doc Values ì‚¬ìš© (ê¸°ë³¸ê°’)
{
  "mappings": {
    "properties": {
      "price": {
        "type": "long"
        // doc_values: true (ê¸°ë³¸ê°’)
      },
      "tags": {
        "type": "keyword"
        // doc_values: true (ê¸°ë³¸ê°’)
      }
    }
  }
}
```

## ğŸ› ï¸ Mapping ì„¸ë¶€ êµ¬ì¡°

### Dynamic Mapping

```json
// ìë™ íƒ€ì… ì¶”ë¡ 
{
  "name": "John",        // text/keyword
  "age": 30,            // long
  "balance": 1500.50,   // float
  "is_active": true,    // boolean
  "created": "2024-01-15" // date
}

// ìƒì„±ë˜ëŠ” ë§¤í•‘
{
  "mappings": {
    "properties": {
      "name": {
        "type": "text",
        "fields": {
          "keyword": {
            "type": "keyword",
            "ignore_above": 256
          }
        }
      },
      "age": { "type": "long" },
      "balance": { "type": "float" },
      "is_active": { "type": "boolean" },
      "created": { "type": "date" }
    }
  }
}
```

### Multi-fields êµ¬ì¡°

```json
{
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "standard",
        "fields": {
          "keyword": {
            "type": "keyword"  // ì •í™•í•œ ë§¤ì¹˜
          },
          "korean": {
            "type": "text",
            "analyzer": "nori"  // í•œêµ­ì–´ ë¶„ì„
          },
          "english": {
            "type": "text",
            "analyzer": "english"  // ì˜ì–´ ë¶„ì„
          }
        }
      }
    }
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
GET /my_index/_search
{
  "query": {
    "match": { "title.korean": "ê²€ìƒ‰ ì—”ì§„" }
  },
  "aggs": {
    "by_title": {
      "terms": { "field": "title.keyword" }
    }
  }
}
```

## ğŸ” ê²€ìƒ‰ ì‹¤í–‰ ê³¼ì •

### Query ì‹¤í–‰ ë‹¨ê³„

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         Query Execution Flow            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Query Parsing
   â”‚
   â”‚  Parse JSON â†’ Query Objects
   â–¼
2. Query Rewriting  
   â”‚
   â”‚  Optimize & Expand Query
   â–¼
3. Shard Selection
   â”‚
   â”‚  Determine Target Shards
   â–¼
4. Query Phase (Scatter)
   â”‚
   â”œâ”€â”€> Shard 0: Search & Score
   â”œâ”€â”€> Shard 1: Search & Score
   â””â”€â”€> Shard 2: Search & Score
   â”‚
   â–¼
5. Coordinate Node (Gather)
   â”‚
   â”‚  Merge & Sort Results
   â–¼
6. Fetch Phase
   â”‚
   â”‚  Get Document Source
   â–¼
7. Response
```

### Scoring ê³¼ì • (BM25)

```
BM25 Score Calculation:

score(D,Q) = âˆ‘ IDF(qi) * TF(qi,D)

where:
- IDF = log(1 + (N - df + 0.5) / (df + 0.5))
- TF = (f(qi,D) * (k1 + 1)) / (f(qi,D) + k1 * (1 - b + b * |D| / avgdl))

ì˜ˆì‹œ:
Query: "elasticsearch search"
Doc1: "Elasticsearch is a search engine" (Score: 2.5)
Doc2: "Search in Elasticsearch" (Score: 2.1)
Doc3: "Database search" (Score: 0.8)
```

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™” êµ¬ì¡°

### ìºì‹± ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Cache Hierarchy                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  1. Node Query Cache (LRU)              â”‚
â”‚     Size: 10% of heap                   â”‚
â”‚     Scope: Node level                   â”‚
â”‚     Content: Filter results             â”‚
â”‚                                          â”‚
â”‚  2. Shard Request Cache                 â”‚
â”‚     Size: 1% of heap                    â”‚
â”‚     Scope: Shard level                  â”‚
â”‚     Content: Aggregation results        â”‚
â”‚                                          â”‚
â”‚  3. OS Page Cache                       â”‚
â”‚     Size: Available RAM                 â”‚
â”‚     Scope: OS level                     â”‚
â”‚     Content: Segment files              â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë©”ëª¨ë¦¬ ì‚¬ìš© íŒ¨í„´

```
Heap Memory (32GB max):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Query Cache (10%)         3.2GB       â”‚
â”‚  Request Cache (1%)        0.32GB      â”‚
â”‚  Field Data Cache          Variable    â”‚
â”‚  Indexing Buffer           Variable    â”‚
â”‚  Other JVM Objects         Remaining   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Off-Heap Memory:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OS Page Cache            Available    â”‚
â”‚  Doc Values (mmap)        As needed    â”‚
â”‚  Segments (mmap)          As needed    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ ìƒ¤ë“œ ë° ë ˆí”Œë¦¬ì¹´ ê´€ë¦¬

### ìƒ¤ë“œ í• ë‹¹ ì•Œê³ ë¦¬ì¦˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Shard Allocation Algorithm         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ 1. Allocation Decision Factors:         â”‚
â”‚    â€¢ Disk usage (watermarks)            â”‚
â”‚    â€¢ Shard count balance                â”‚
â”‚    â€¢ Node attributes                    â”‚
â”‚    â€¢ Allocation awareness               â”‚
â”‚                                          â”‚
â”‚ 2. Watermark Settings:                  â”‚
â”‚    Low: 85% (stop allocating)           â”‚
â”‚    High: 90% (start moving)             â”‚
â”‚    Flood: 95% (read-only)               â”‚
â”‚                                          â”‚
â”‚ 3. Rebalancing:                         â”‚
â”‚    threshold: 1.0                       â”‚
â”‚    concurrent_rebalance: 2              â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Primary/Replica ë™ê¸°í™”

```
Write Process:

     Client
       â”‚
       â–¼
  Coordinating Node
       â”‚
       â–¼
  Primary Shard
       â”‚
   â”Œâ”€â”€â”€â”¼â”€â”€â”€â”
   â–¼   â–¼   â–¼
  R1  R2  R3 (Parallel)
   â”‚   â”‚   â”‚
   â–¼   â–¼   â–¼
  ACK ACK ACK
       â”‚
       â–¼
    Success
```

## ğŸ” ë³´ì•ˆ ë° ê¶Œí•œ ê´€ë¦¬

### X-Pack Security êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Security Architecture            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  Authentication:                         â”‚
â”‚  â€¢ Native (internal users)              â”‚
â”‚  â€¢ LDAP/Active Directory               â”‚
â”‚  â€¢ SAML/OIDC                            â”‚
â”‚  â€¢ API Keys                             â”‚
â”‚                                          â”‚
â”‚  Authorization:                          â”‚
â”‚  â€¢ Role-Based Access Control (RBAC)    â”‚
â”‚  â€¢ Document Level Security (DLS)       â”‚
â”‚  â€¢ Field Level Security (FLS)          â”‚
â”‚                                          â”‚
â”‚  Encryption:                             â”‚
â”‚  â€¢ TLS/SSL for transport               â”‚
â”‚  â€¢ Encrypted snapshots                 â”‚
â”‚                                          â”‚
â”‚  Auditing:                               â”‚
â”‚  â€¢ Access logs                         â”‚
â”‚  â€¢ Security events                     â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸŒ í´ëŸ¬ìŠ¤í„° í™•ì¥ íŒ¨í„´

### Hot-Warm-Cold Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Hot-Warm-Cold Architecture          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  HOT Nodes (SSD, High CPU/RAM):         â”‚
â”‚  â€¢ Recent data (0-7 days)               â”‚
â”‚  â€¢ Active indexing                      â”‚
â”‚  â€¢ Frequent queries                     â”‚
â”‚                                          â”‚
â”‚       â†“ (ILM Policy)                     â”‚
â”‚                                          â”‚
â”‚  WARM Nodes (HDD, Medium specs):        â”‚
â”‚  â€¢ Older data (7-30 days)               â”‚
â”‚  â€¢ Read-only                           â”‚
â”‚  â€¢ Occasional queries                   â”‚
â”‚                                          â”‚
â”‚       â†“ (ILM Policy)                     â”‚
â”‚                                          â”‚
â”‚  COLD/Frozen (Object Storage):          â”‚
â”‚  â€¢ Archive data (30+ days)              â”‚
â”‚  â€¢ Searchable snapshots                â”‚
â”‚  â€¢ Rare access                         â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ë²¤ì¹˜ë§ˆí¬ ë° ì„±ëŠ¥ ì§€í‘œ

### ì„±ëŠ¥ ì¸¡ì • í¬ì¸íŠ¸

```
Key Performance Metrics:

1. Indexing Performance:
   â€¢ Docs/sec: 10,000-50,000
   â€¢ MB/sec: 10-100 MB/s
   â€¢ Latency: < 100ms

2. Search Performance:
   â€¢ QPS: 100-1000
   â€¢ Latency p50: < 50ms
   â€¢ Latency p99: < 200ms

3. Resource Utilization:
   â€¢ CPU: < 70%
   â€¢ Memory: < 85%
   â€¢ Disk I/O: < 80%
   â€¢ Network: < 50%

4. Cluster Health:
   â€¢ Shard count: < 1000 per node
   â€¢ Shard size: 20-40 GB
   â€¢ Segment count: < 50 per shard
```

---

ğŸ’¡ **ë‹¤ìŒ ë‹¨ê³„**: [Docker í™˜ê²½ ì„¤ì •](../01-setup/README.md)ì—ì„œ ì‹¤ìŠµ í™˜ê²½ì„ êµ¬ì¶•í•´ë³´ì„¸ìš”!